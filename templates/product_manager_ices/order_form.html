{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% load cloudinary %}
{% block content %}
    <section>
        <article>
            <div class="row">
                <div class="col-8 pl-0 pr-1">
                    <form class="p-0 m-0" method="post">{% csrf_token %}
                        <!--form to add orderitem-ice -->
                        <div class="border border-primary rounded col-md-7 d-inline-block p-0"
                             id="form-to-add-type-ice">
                            <div class="form-group mb-0 text-center">
                                <label class="mb-0 ">TYPE OF ICE</label>
                                <div class="radio-toolbar">
                                    {% for radio in add_order_form.ice %}
                                        {{ radio.tag }}
                                        <label for="{{ radio.id_for_label }}"
                                               id="{{ radio.choice_label }}"
                                               class="text-uppercase">{{ radio.choice_label }}</label>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>
                        <!--form to add quantity-->
                        <div class=" d-inline-block col-md-4 p-0 pl-4 pt-md-4 text-center align-top"
                             id="form-to-quantity">

                            <label class="d-none" for="{{ add_order_form.quantity.id_for_label }}">Quantity</label>
                            <div class="add-odd-button d-inline-block bg-info text-center rounded border-dark border minus">
                                <span class=" add-odd-button">-</span>
                            </div>
                            <div class="d-inline-block text-center" style="width: 25%"><input type="number"
                                                                                              class="count"
                                                                                              name="{{ add_order_form.quantity.html_name }}"
                                                                                              value="{{ add_order_form.quantity.value }}"
                                                                                              min="{{ add_order_form.quantity.initial }}"
                                                                                              required
                                                                                              id="{{ add_order_form.quantity.id_for_label }}">
                            </div>
                            <div class="add-odd-button d-inline-block bg-info text-center rounded border-dark border plus">
                                <span class=" add-odd-button">+</span>
                            </div>
                        </div>
                        <!--form to add flavour-->
                        <div class="flavour-toolbar col-md-12 m-0 p-1 ">
                            {% for radio in add_order_form.flavour %}
                                {{ radio.tag }}
                                <label for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                            {% endfor %}
                        </div>
                        <!--button to add to cart-->
                        <div class="addtocart text-center col-md-12">
                            <input class="btn btn-success btn-lg" type="submit" value="Add to cart">
                        </div>
                    </form>
                </div>
                <!-- CART -->
                <div class="col-md-4 p-0" id="cart">
                    {% if order_in_cart %}
                        <div class="insideofcart border border-primary rounded d-inline-block bg-light col-md-12 pb-1 p-0">
                        <h1 class="text-center bg-warning col-md-12">CART</h1>
                        <!-- postpone or delete order-->

                        <div class="order_list my-1 p-0">
                            <ul class="list-unstyled list-group">
                                {% for ices in order_in_cart.ices_ordered.all %}
                                    <form action="{% url 'delete_oi' id=ices.id %}" method="post">
                                        {% csrf_token %}
                                        <div class="d-inline-block col-md-12 p-0 align-text-center">
                                            <li class="list-group-item list-group-item-info px-0 py-1">
                                                <span class="text-truncate d-inline-block col-md-8 p-0">{{ ices.ice.type }}{{ ices.quantity }}{{ ices.flavour.all }}</span>
                                                <span class=" p-0 d-inline-block align-text-bottom col-md-3 float-right"><input
                                                        class="btn btn-primary btn-sm"
                                                        type="submit"
                                                        value="Delete"
                                                        style="width: 100%"></span></li>
                                        </div>

                                    </form>
                                {% endfor %}
                                <p>Total:{% if sumarize %}Sum: {{ sumarize }}zł{% else %} 0zł {% endif %}</p>
                                <div class="col-12 px-0 my-2 bg-warning">
                                    <span class="d-inline-block col-md-6 text-uppercase">Total:</span>
                                    <span class="d-inline-block text-truncate col-md-5 align-bottom text-right">{% if sumarize %}
                                        {{ sumarize }}zł{% else %} 0zł {% endif %}</span>
                                </div>
                            </ul>
                        </div>

                        <div class="text-right">

                            <a href="{% url 'postpone_order' id=order_in_cart.id %}"
                               class="btn btn-primary btn-lg">Postpone</a>
                            <form class="d-inline" method="POST"
                                  action="{% url 'delete_order' pk=order_in_cart.id %}">
                                {% csrf_token %}
                                <input class="btn btn-outline-danger btn-lg" type="submit" value="Delete">
                            </form>

                        </div>
                        <!-- Button trigger modal -->
                        <div class=" col-md-12 text-center  mt-5 ">
                            <button id="paybutton" type="button" class="btn btn-primary btn-lg col-md-6"
                                    data-toggle="modal"
                                    data-target="#exampleModalCenter">
                                PAY
                            </button>
                        </div>


                    {% else %}
                        <div class="text-center border border-dark rounded">
                            <h1>Cart</h1>
                            <h3>No product in the cart</h3>
                        </div>

                    {% endif %}

                    </div>

                </div>
            </div>
        </article>

        {% if order_in_cart %}
            <article>

                <!-- Modal -->
                <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" id="exampleModalCenterTitle">Order Cart</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body mb-0">
                                <form method="post" action="{% url 'change_to_finish' id=order_in_cart.id %}">
                                    {% csrf_token %}
                                    <div id="div_id_content" class="form-group mb-0">
                                        <div class="border rounded border-primary mb-2">
                                            <ul class="d-inline-block">
                                                {% for ices in order_in_cart.ices_ordered.all %}
                                                    {% csrf_token %}
                                                    <li>{{ ices }}</li>
                                                {% endfor %}
                                            </ul>
                                            <p class="d-inline-block float-right">Sum:{{ sumarize }} zł</p>
                                        </div>
                                        <!-- Callculator for counting change  -->

                                        <div id="sumtopay" value="{{ sumarize }}">
                                            <label for="clientmoney">Calculator</label>
                                            <input type="number" id="clientmoney">

                                            <label class="border rounded">Change:</label>
                                            <output id="clientchange">zł</output>
                                        </div>
                                        <div class="text-center mt-2">
                                            <input class="btn btn-outline-success mx-auto btn-lg"
                                                   id="finish-order-btn"
                                                   type="submit"
                                                   value="Finish">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </article>

        {% endif %}


    </section>

{% endblock content %}


